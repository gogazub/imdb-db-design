# üé¨ IMDb-like Database Design

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç - **–¥–∏–∑–∞–π–Ω —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –ø–æ —Ç–∏–ø—É IMDB**, –≤–∫–ª—é—á–∞—é—â–µ–≥–æ —Ñ–∏–ª—å–º—ã, —Å–µ—Ä–∏–∞–ª—ã, –∞–∫—Ç–µ—Ä–æ–≤, –∫–æ–º–ø–∞–Ω–∏–∏, –Ω–∞–≥—Ä–∞–¥—ã, –æ—Ç–∑—ã–≤—ã –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏.  

–ë–∞–∑–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–∞ **PostgreSQL**.  
–î–ª—è –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Faker**

---

## –ö—Ä–∞—Ç–∫–∞—è —Å—Ö–µ–º–∞ –ë–î

```text
Users (id, username, email, password_hash, reviews_count)
Title (id, name, description, budget, box_office, rating, rate_count, ...)
 ‚îú‚îÄ Film (titleID, year, duration)
 ‚îú‚îÄ Series (titleID, years, seasons_count, episode_duration)
 ‚îú‚îÄ TitleGenres (titleID, genreID)
 ‚îú‚îÄ TitleLanguage (titleID, languageID)
 ‚îú‚îÄ TitleCompany (titleID, companyID)
 ‚îú‚îÄ TitleAwards (titleID, awardID, year, result)
 ‚îú‚îÄ TitleCountries (titleID, countryID)
 ‚îú‚îÄ TitlePersons (titleID, personID, roleID)
 ‚îî‚îÄ Media (titleID, url)

Genres (id, name) ‚Äî –∂–∞–Ω—Ä—ã  
Language (id, name) ‚Äî —è–∑—ã–∫–∏  
Company (id, name) ‚Äî —Å—Ç—É–¥–∏–∏  
Countries (id, name) ‚Äî —Å—Ç—Ä–∞–Ω—ã  
Awards (id, name) ‚Äî –Ω–∞–≥—Ä–∞–¥—ã

Persons (id, countryID, name, birth_day, ...)  
 ‚îú‚îÄ Roles (id, name)
 ‚îú‚îÄ TitlePersons (—Å–≤—è–∑—å —Å Title + Roles)
 ‚îú‚îÄ PersonAwards (personID, awardID, year, result)
 ‚îî‚îÄ Photo (personID, url)

Ratings (titleID, userID, rating_value)  
Reviews (titleID, userID, text, likes, dislikes)
```

üìå –¢–∞–±–ª–∏—Ü—ã `TitleGenres`, `TitleLanguage`, `TitleCompany`, `TitleAwards`, `TitleCountries`, `TitlePersons` —Ä–µ–∞–ª–∏–∑—É—é—Ç —Å–≤—è–∑–∏ –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º.

---

## –ü—Ä–∏–º–µ—Ä—ã SQL-–∑–∞–ø—Ä–æ—Å–æ–≤

| ‚Ññ  | –ù–∞–∑–≤–∞–Ω–∏–µ                                        | –§–∞–π–ª                    | –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞          |
|----|-------------------------------------------------|--------------------------|-----------------------|
| 1  | –§–∏–ª—å–º—ã –ø–æ—Å–ª–µ 2017 –≥–æ–¥–∞                          | `–∑–∞–ø—Ä–æ—Å1.sql`            | `SELECT` + `JOIN` |
| 2  | –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ —Ñ–∏–ª—å–º–æ–≤ –∏–∑ –Ø–ø–æ–Ω–∏–∏               | `–∑–∞–ø—Ä–æ—Å2.sql`            | `AVG`, `HAVING` |
| 3  | –§–∏–ª—å–º—ã —Å ENG + SPA + IT —è–∑—ã–∫–∞–º–∏                 | `–∑–∞–ø—Ä–æ—Å3.sql`            | `STRING_AGG` |
| 4  | –¢–æ–ø-5 —Ñ–∏–ª—å–º–æ–≤ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É –∏ –Ω–∞–≥—Ä–∞–¥–∞–º           | `–∑–∞–ø—Ä–æ—Å4.sql`            | `CTE`, `GROUP BY` |
| 5  | –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º                     | `–∑–∞–ø—Ä–æ—Å5.sql`            | `GROUP BY` |
| 6  | –§–∏–ª—å–º—ã —Å –æ–¥–Ω–∏–º –∂–∞–Ω—Ä–æ–º                          | `–∑–∞–ø—Ä–æ—Å6.sql`            | `HAVING` |
| 7  | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ + –≤—ã–±–æ—Ä –∞–∫—Ç—ë—Ä–æ–≤               | `–∑–∞–ø—Ä–æ—Å7.sql`            | `UPDATE`, `SELECT` |
| 8  | –§–∏–ª—å–º—ã —Å —Ü–∏—Ñ—Ä–∞–º–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏                    | `–∑–∞–ø—Ä–æ—Å8.sql`            | regex |
| 9  | –°–∞–º—ã–π –Ω–∏–∑–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –∏ –º–∞–∫—Å. –æ—Ü–µ–Ω–∫–∞            | `–∑–∞–ø—Ä–æ—Å9.sql`            | CTE |
| 10 | –ü–µ—Ä—Å–æ–Ω—ã –±–µ–∑ –Ω–∞–≥—Ä–∞–¥                             | `–∑–∞–ø—Ä–æ—Å10#1.sql`         | `NOT EXISTS` |
| 11 | –ü–µ—Ä—Å–æ–Ω—ã –±–µ–∑ –Ω–∞–≥—Ä–∞–¥ (—á–µ—Ä–µ–∑ LEFT JOIN)           | `–∑–∞–ø—Ä–æ—Å10#2.sql`         | `LEFT JOIN` |
| 12 | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π –∞–∫—Ç—ë—Ä–æ–≤ (–∫–∏–Ω–æ vs —Å–µ—Ä–∏–∞–ª—ã)     | `–∑–∞–ø—Ä–æ—Å11.sql`           | `CASE`, `JOIN` |
| 13 | –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –æ–±—Ö–æ–¥ —Ä–æ–ª–µ–π                        | `–∑–∞–ø—Ä–æ—Å—Ä–µ–∫—É—Ä—Å.sql`       | `WITH RECURSIVE` |
| 14 | –ê–∫—Ç—ë—Ä—ã —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ–º —Ä–æ–ª–µ–π       | `–º–æ–∏ÃÜ–∑–∞–ø—Ä–æ—Å1.sql`        | CTE, `ARRAY_AGG` |
| 15 | –¢–æ–ø-5 —Å—Ç—É–¥–∏–π –ø–æ –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ —Ñ–∏–ª—å–º–æ–≤           | `–º–æ–∏ÃÜ–∑–∞–ø—Ä–æ—Å2.sql`        | `RANK()`, –∞–≥—Ä–µ–≥–∞—Ç—ã |

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
createdb mydb

# 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
python script.py

# 3. –ù–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–º–∏ (–ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è)
python insert2.py
# –∏–ª–∏ –±—ã—Å—Ç—Ä–∞—è –≤–µ—Ä—Å–∏—è
python insert_users.py

# 4. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ psql
psql -d mydb -f –∑–∞–ø—Ä–æ—Å1.sql
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ `insert`-—Å–∫—Ä–∏–ø—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç –ø–æ–ª–Ω—É—é –æ—á–∏—Å—Ç–∫—É (`TRUNCATE CASCADE`) –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö.  
- Faker –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞, email, –æ–ø–∏—Å–∞–Ω–∏—è –∏ –¥—Ä. –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.  
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–∏–ª—å–º—ã –∏ —Å–µ—Ä–∏–∞–ª—ã, –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å, –∂–∞–Ω—Ä—ã, –∞–∫—Ç—ë—Ä—ã, —Å—Ç—É–¥–∏–∏ –∏ –Ω–∞–≥—Ä–∞–¥—ã.  
- SQL-–∑–∞–ø—Ä–æ—Å—ã –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ **–∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —Å—Ö–µ–º—ã**.
